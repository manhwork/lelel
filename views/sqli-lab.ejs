<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Injection Lab</title>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <div class="container">
        <header>
            <a href="/" class="back-link">‚Üê Quay l·∫°i</a>
            <h1>üíâ SQL Injection Lab</h1>
            <p class="subtitle">Th·ª±c h√†nh k·ªπ thu·∫≠t t·∫•n c√¥ng SQL Injection</p>
        </header>

        <main class="lab-content">
            <div class="info-box">
                <h3>üìã M·ª•c ti√™u</h3>
                <ul>
                    <li>T√¨m ki·∫øm c√°c b√†i vi·∫øt theo ti√™u ƒë·ªÅ</li>
                    <li>Ph√°t hi·ªán l·ªó h·ªïng SQL Injection</li>
                    <li>Khai th√°c ƒë·ªÉ l·∫•y th√¥ng tin t·ª´ c√°c b·∫£ng kh√°c</li>
                    <li>T√¨m flag b√≠ m·∫≠t trong database</li>
                </ul>
            </div>

            <div class="search-section">
                <h2>T√¨m Ki·∫øm B√†i Vi·∫øt</h2>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Nh·∫≠p t·ª´ kh√≥a ƒë·ªÉ t√¨m ki·∫øm..." />
                    <button id="searchBtn">üîç T√¨m ki·∫øm</button>
                </div>
            </div>

            <div id="queryDisplay" class="query-display" style="display: none;">
                <strong>Query SQL th·ª±c thi:</strong>
                <code id="queryText"></code>
            </div>

            <div id="results" class="results-section">
                <h3>Danh S√°ch B√†i Vi·∫øt:</h3>
                <div class="results-grid">
                    <% posts.forEach(post=> { %>
                        <div class="result-item">
                            <div class="result-id">ID: <%= post.id %>
                            </div>
                            <div class="result-title">
                                <%= post.title %>
                            </div>
                        </div>
                        <% }); %>
                </div>
            </div>

            <div class="hints-box">
                <h3>üí° G·ª£i √Ω</h3>
                <details>
                    <summary>G·ª£i √Ω 1: Ki·ªÉm tra l·ªó h·ªïng</summary>
                    <p>Th·ª≠ nh·∫≠p d·∫•u ngo·∫∑c ƒë∆°n <code>'</code> v√†o √¥ t√¨m ki·∫øm xem c√≥ l·ªói g√¨ kh√¥ng</p>
                </details>
                <details>
                    <summary>G·ª£i √Ω 2: Union-based SQL Injection</summary>
                    <p>S·ª≠ d·ª•ng <code>UNION SELECT</code> ƒë·ªÉ k·∫øt h·ª£p k·∫øt qu·∫£ t·ª´ c√°c b·∫£ng kh√°c</p>
                </details>
                <details>
                    <summary>G·ª£i √Ω 3: Kh√°m ph√° c·∫•u tr√∫c</summary>
                    <p>SQLite c√≥ b·∫£ng h·ªá th·ªëng <code>sqlite_master</code> ch·ª©a th√¥ng tin v·ªÅ c√°c b·∫£ng</p>
                </details>
                <details>
                    <summary>G·ª£i √Ω 4: Payload m·∫´u</summary>
                    <p>Th·ª≠: <code>' UNION SELECT id, flag FROM secret--</code></p>
                </details>
            </div>
        </main>

        <footer>
            <p>‚ö†Ô∏è ƒê√¢y l√† m√¥i tr∆∞·ªùng th·ª±c h√†nh - Query SQL kh√¥ng ƒë∆∞·ª£c filter</p>
        </footer>
    </div>

    <script>
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const resultsDiv = document.getElementById('results');
        const queryDisplay = document.getElementById('queryDisplay');
        const queryText = document.getElementById('queryText');

        function performSearch() {
            const query = searchInput.value;

            fetch(`/api/search?q=${encodeURIComponent(query)}`)
                .then(res => res.json())
                .then(data => {
                    // Hi·ªÉn th·ªã query SQL
                    queryDisplay.style.display = 'block';
                    queryText.textContent = data.query;

                    // Hi·ªÉn th·ªã k·∫øt qu·∫£
                    if (data.error) {
                        resultsDiv.innerHTML = `
                            <div class="error-box">
                                <h3>‚ùå L·ªói SQL</h3>
                                <pre>${data.error}</pre>
                            </div>
                        `;
                    } else if (data.results && data.results.length > 0) {
                        let html = '<h3>K·∫øt qu·∫£ t√¨m ki·∫øm:</h3><div class="results-grid">';
                        data.results.forEach(item => {
                            html += `
                                <div class="result-item">
                                    <div class="result-id">ID: ${item.id}</div>
                                    <div class="result-title">${item.title}</div>
                                </div>
                            `;
                        });
                        html += '</div>';
                        resultsDiv.innerHTML = html;
                    } else {
                        resultsDiv.innerHTML = '<p class="no-results">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ n√†o</p>';
                    }
                })
                .catch(err => {
                    resultsDiv.innerHTML = `<div class="error-box">L·ªói: ${err.message}</div>`;
                });
        }

        searchBtn.addEventListener('click', performSearch);
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') performSearch();
        });
    </script>
</body>

</html>